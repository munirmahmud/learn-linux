# Class 15: chmod

### Parmission Details

ডিফল্ট ভাবে লিনাক্সের ফাইলের কোনো এক্সিকিউট (x) পার্মিশন থাকে না। ডিফল্ট ভাবে লিনাক্সের ডিরেক্টরিতে ইউজার, গ্রুপ এবং অন্যান্য ইউজারদের জন্য এক্সেকিউট (x) পার্মিশন থাকে।

`r for read` (4) - ফাইলের ক্ষেত্রে 'read' অর্থ ফাইলটি পড়তে পারবে এবং ডিরেক্টরির ক্ষেত্রে read অর্থ, ডিরেক্টরি টা কপি করা যাবে।

`w for write` (2) - ফাইলের ক্ষেত্রে 'write' অর্থ ফাইলটি এডিট এবং সেভ করা যাবে। ডিরেক্টরির ক্ষেত্রে write অর্থ, ডিরেক্টরির ভিতরে paste করা যাবে।

`x for execute` (1) - ফাইলের ক্ষেত্রে 'execute' পার্মিশন দরকার নাই। কিন্ত, ফাইলটি যদি, প্রোগাম/স্ক্রিপ্ট/এপ্লিকেশন হয়, তাহলে অবশ্যই execute পার্মিশন থাকতে হবে। ডিরেক্টরির ক্ষেত্রে 'execute' হচ্ছে ডিরেক্টরির মধ্যে প্রবেশ করার জন্য, অর্থাৎ যে ডিরেক্টরিতে 'execute' পার্মিশন নাই, সেখানে প্রবেশ করা যাবে না।

`- = no permission` (0) - এক্ষেত্রে `read, write, execute` কোনো পার্মিশন থাকছে না।

ফাইলের ডিফাল্ট পারমিশন file (644)
rw- = 4 + 2 + 0 = 6 (U)
r-- = 4 + 0 + 0 = 4 (G)
r-- = 4 + 0 + 0 = 4 (O)
---------------------644

ডিরেক্টরির ডিফাল্ট পারমিশন dir (755)
rwx = 4 + 2 + 1 = 7 (U)
r-x = 4 + 0 + 1 = 5 (G)
r-x = 4 + 0 + 1 = 5 (O)
--------------------755

আমরা আমাদের প্রয়োজনে পার্মিশন লেভেল পরিবর্তন করতে পারি।

Maximum File Permission: 666 => (rw- rw- rw-)
Maximum Directory Permission: 777 => (rwx rwx rwx)

### File Parmission

কোন ফাইল বা ডিরেক্টরির পারমিশন পরিবর্তন করার জন্য `chmod` কমান্ড ব্যাবহার হয়।

`chmod u+x file_or_directory_name`

এখানে `u` মানে হল ইউজার। আর `u` এর স্থানে `g or o` ব্যাবহার করতে পারি।
`u for user`
`g for group`
`o for others`

`+ or -` ইউজার পারমিশন অ্যাড অথবা রিমুভ করার জন্য ব্যাবহার করা হয়।

`r for read`
`w for write`
`x for execute`

`chmod u+r file.txt`
`chmod u+w file.txt`
`chmod u+x file.txt`

আমরা এভাবে আলাদা আলাদা করেও পারমিশন দিতে পারি আবার একসাথেও দিতে পারি। যেমনঃ `chmod u+rwx file.txt`

পারমিশন রিমুভ করতে চাইলে `chmod u-x file.txt`

`chmod g+rwx file.txt`
`chmod o+rwx file.txt`

আমরা এভাবে গ্রুপ এবং আদারসের পারমিশন দিতে পারি। আবার একসাথে ইউজার, গ্রুপ, এবং আদারসের পারমিশন দিতে পারি।

`chmod u+rwx,g+rwx,o+rwx file.txt`

যদি সবার জন্য কমন পারমিশন হয় তাহলে এভাবে দিতে পারি।

`chmod ug+rwx file.txt`

একি সাথে অ্যাড এবং রিমুভ করার জন্য।
`chmod u+rw,g-rw file.txt`

সবার জন্য কমন পারমিশন হলে অর্থাৎ ইউজার, গ্রুপ, এবং আদারসের জন্য তাহলে আমরা এভাবে কমান্ড লিখতে পারি। `chmod a+rwx file.txt`

`a for all`

আমরা নির্দিষ্ট কোন পারমিশন রেখে বাকি পারমিশন গুলো রিমুভ করে দিতে চাইলে `chmod a=rw file.txt`। এখানে সবার জন্য রিড এবং রাইট পারমিশন থাকবে এবং বাকিগুলো রিমুভ হয়ে যাবে।

`chmod 007 file.txt` এক্ষেত্রে শুধুমাত্র আদারসের জন্য `read, write, & execute` হবে এবং বাকিদের পারমিশন রিমুভ হয়ে যাবে। এই কমানডকে এভাবেও লেখা যায় `chmod 7 file.txt`

`chmod +7 file.txt` আগের পারমিশন ঠিক রেখে নতুন পারমিশন অ্যাাড করার জন্য।

`r--r--r-x = 445` একটা ফাইলের পারমিশন এমন দেয়া আছে। এখন পুরনো পারমিশন ঠিক রেখে নতুন পারমিশন অ্যাড করতে চাইলে `chmod +020 file.txt`। তার মানে হলো পুরনো পারমিশন ঠিক রেখে শুধুমাত্র গ্রুপে `write` পারমিশন অ্যাড হলো।

`chmod -033 file.txt` ইউজারের পারমিশন ঠিক রেখে গ্রুপ এবং আদারসের পারমিশন থেকে `write & execute` রিমুভ করে দেয়া হলো।

`chmod =333 file.txt` সবার পারমিশন থেকে `read` কে রিমুভ করে `write & execute` পারমিশন অ্যাড করে দেয়া হলো।

`chmod =300 file.txt` ইউজারের পারমিশন থেকে `write & execute` রেখে বাকিদের এবং ইউজারের `read` পারমিশন রিমুভ করে দেয়া হলো।

এক্ষেত্রে `=` দেয়া আর না দেয়া একই।

### Directory Parmission

`chmod -R 000 linux/` লিনাক্স ডিরেক্টরি এবং এর ভিতরের সকল ফাইল এবং ফোল্ডারের পারমিশন চেঞ্জ হবে।

`-R for recursively`

`chmod -R 000 linux/*` লিনাক্স ডিরেক্টরির পারমিশন ঠিক থাকবে কিন্তু এর ভিতরের সকল ফাইল এবং ফোল্ডারের পারমিশন চেঞ্জ হবে।

### Advance Permission

লিনাক্সের standard parmission এর পাশাপাশি কিছু special parmission ব্যবহার করা হয়। Standard parmission প্রকাশ করা হয় `r=read, w=write, x=execute, -= no permission`

Special parmission প্রকাশ করা হয়: `S, S, T / s, s, t` দিয়ে।

- 4 = SUID (s/S) - SUID পার্মিশন ব্যবহ্রিত হয় Owner ফিল্ডে (1st field) এবং এটা প্রকাশ করা হয় `S` (Capital S) অথবা `s` (Small s) দিয়ে।

- 2 = SGID (s/S) - SGID পার্মিশন ব্যবহ্রিত হয় Group ফিল্ডে (2nd field) এবং এটাও প্রকাশ করা হয় `S` (Capital S) অথবা `s` (Small s) দিয়ে।

- 1 = Sticky bit (t/T) - Sticky পার্মিশন ব্যবহ্রিত হয় Others ফিল্ডে (3rd field) এবং এটা প্রকাশ করা হয় `T` (Capital T) অথবা `t` (Small t) দিয়ে।

নোটঃ ফাইল/ডিরেক্টরিতে যদি এক্সিকিউট পার্মিশন থাকে, তাহলে স্পেশাল পার্মিশন সেট করার পরে ছোট হাতের `s, s, t` থাকবে, আর যদি কোনো এক্সিকিউট পার্মিশন (x) না থাকে সেক্ষেত্রে বড হাতের `S, S, T`

`rwx r-x r-x = rws r-s r-t - x` বিট সহ স্পেশাল পার্মিশনের ব্যবহার করা হয়।
`rw- r-- r-- = rwS r-S r-T - x` বিট বাদে স্পেশাল পার্মিশনের ব্যবহার করা হয়।

`SUID Bit, GUID Bit, Sticky Bit`

`SUID Bit for User - (s/S)`
`GUID Bit for Group Owner - (s/S)`
`Sticky Bit for Others User - (t/T)`

### Sticky Bit

আমরা `footage` নামে একটা ডিরেক্টরি তৈরি করি। আদার ইউজারের জন্য এর পারমিশন দেই `read, write & execute`
`chmod o+rwx footage` এই পারমিশনে একজন ইউজার আরেকজন ইউজারের ড্যাটা ডিলিট করে দিতে পারবে।

এটা থেকে বাচার জন্য আমরা `Sticky Bit Parmission` সেট করতে পারি। `chmod o+t footage` এখন কেউ কারো ড্যাটা ডিলিট করতে পারবে না।

পারমিশনের বিস্তারিত দেখার জন্য `getfacl footage`

### Change User & Group Ownership

`chown` দিয়ে ইউজার এবং গ্রুপ ওনারশিপ পরিবর্তন করা যায়।
`chgrp` দিয়ে শুধুমাত্র গ্রুপ ওনারশিপ পরিবর্তন করা যায়।

### Chown

আমরা `mkdir /automation` নামে একটা ডিরেক্টরি তৈরি করি। ডিফ্লটভাবে এর ইউজার এবং গ্রুপ ওনারশিপ থাকে যিনি তৈরি করেন তার।

`chown jamal /automation` এখানে জামালকে ওনারশিপ দেয়া হলো।

`chown jamal: /automation` এখানে জামালকে ওনারশিপ দেয়া হলো আর কোলনের পরে কিছু উল্লেখ না করলে জামাল ইউজারের প্রাইমারি গ্রুপ সেট হয়ে যাবে।

`chown :devops /automation` এখানে ডেভঅপ্সকে ডিরেক্টরির গ্রুপ ওনারশিপ দেয়া হলো।

`chown kamal:devops /automation` এখানে কামালকে ইউজার এবং ডেভঅপ্সকে ডিরেক্টরির ওনারশিপ দেয়া হলো।

### Chgrp

`chgrp devops /automation` এখানে ডেভঅপ্সকে ডিরেক্টরির ওনারশিপ দেয়া হলো।

### GUID Bit

এখন `devops` টিমের মেম্বাররা `automation` ডিরেক্টরিতে কাজ করতে পারবে। কিন্তু একটা প্রব্লেম আছে তা হলো যদি কেউ কোন ফাইল তৈরি করে শুধুমাত্র সে ছাডা আর কেউ এডিট করতে পারবে না। আমরা চাই যে, মেম্বাররা একে অপরের ফাইল এডিট করতে পারবে এবং ভবিষ্যতে যদি কেউ `devops` টিমের মেম্বার হয় তাহলে সেও যা তৈরি করবে তাও `devops` গ্রুপের অন্য মেম্বেররা এডিট করতে পারবে। এই সমস্যার সমাধান গ্রুপের উপর স্পেশাল পারমিশন দিয়ে করতে পারি।

`chmod g+s /automation`  
`ll -d /automation/`
`drwxrws---. 2 root devops 6 Mar 21 05:16 /automation/`

স্পেশাল পারমিশন দেয়ার কারণে সব ফাইল এবং ডিরেক্টরির গ্রুপ ওনার হবে `devops` গ্রুপ। আর এই কারনেই একজন মেম্বার আরেক মেম্বারের ফাইলে এডিট করতে পারবে।

### SUID Bit

`which rm` দিয়ে `rm` কমান্ডের ফাইল পাথটা জেনে নিলাম। এই কমান্ডের এ্যাক্সেস সবার আছে কিন্তু এই কমান্ড দিয়ে রুটের কোন কিছুই ডিলিট করা যাবে না।

`ll /usr/bin/rm`
`-rwxr-xr-x. 1 root root 61464 Jan  6  2023 /usr/bin/rm`

আমরা `SUID Bit` পারমিশনের মাধ্যমে এই কমান্ড দিয়ে রেগুলার ইউজারও রুটের ফাইলে ডিলিট করে দিতে পারবে।

`chmod u+s /usr/bin/rm` তাহলে এখন রেগুলার ইউজার এই কমান্ড ইউজ করে রুটের `file & directory` ডিলিট করে দিতে পারবে।

`ll /usr/bin/rm`
`-rwsr-xr-x. 1 root root 61464 Jan  6  2023 /usr/bin/rm`

`নিচের কমান্ড দিয়ে আগে চেক করে নেয়া কোন রিস্কি কমান্ডে স্পেশাল পারমিশন দেয়া আছে কিনা!`

`find / -iname "*" -perm u+s` ইউজার এক্সিকিউট করতে পারে এমন সব ফাইলের কোন স্পেসাল পারমিশন আছে কিনা তা খুজে বের করার জন্য। এই কমান্ড শুধু সেই সব ফাইল খুজবে যেই ফাইলে শুধু স্পেশাল পারমিশন আছে যদি অন্য কোন পারমিশন থাকে তাহলে সে ignore করবে।

`find / -iname "*" -perm -u+s` এখন সে স্পেসাল পারমিশন দেয়া ফাইল খুজবে যদি অন্য পারমিশনও দেয়া থাকে তাতে কোন সমস্যা নেই।
